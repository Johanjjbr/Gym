# ðŸ—ï¸ ARQUITECTURA DEL SISTEMA

## Sistema de GestiÃ³n de Gimnasio Los Teques

---

## ðŸ“ ARQUITECTURA GENERAL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND (React + TypeScript)            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Dashboard   â”‚  â”‚    Users     â”‚  â”‚   Payments   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Routines    â”‚  â”‚  Attendance  â”‚  â”‚    Staff     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚         API Client (/src/app/lib/api.ts)           â”‚        â”‚
â”‚  â”‚  - auth.login()                                     â”‚        â”‚
â”‚  â”‚  - users.getAll()                                   â”‚        â”‚
â”‚  â”‚  - payments.create()                                â”‚        â”‚
â”‚  â”‚  - stats.getDashboard()                             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ HTTPS
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SUPABASE EDGE FUNCTIONS                       â”‚
â”‚                  (Hono Server - Deno Runtime)                   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚         /supabase/functions/server/index.tsx        â”‚        â”‚
â”‚  â”‚                                                     â”‚        â”‚
â”‚  â”‚  Endpoints:                                         â”‚        â”‚
â”‚  â”‚  - POST /auth/login                                 â”‚        â”‚
â”‚  â”‚  - GET  /users                                      â”‚        â”‚
â”‚  â”‚  - POST /payments                                   â”‚        â”‚
â”‚  â”‚  - GET  /stats                                      â”‚        â”‚
â”‚  â”‚  - ... (todos los endpoints CRUD)                  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â”‚  ðŸ” AutenticaciÃ³n: Supabase Auth (JWT Tokens)                  â”‚
â”‚  ðŸ”’ Seguridad: Row Level Security (RLS)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ PostgreSQL Protocol
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE DATABASE                            â”‚
â”‚                      (PostgreSQL)                               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  users   â”‚  â”‚  staff   â”‚  â”‚ payments â”‚  â”‚attendanceâ”‚       â”‚
â”‚  â”‚  (12)    â”‚  â”‚  (3)     â”‚  â”‚  (2)     â”‚  â”‚  (0)     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚physical_ â”‚  â”‚routine_  â”‚  â”‚exercise_ â”‚  â”‚user_rout.â”‚       â”‚
â”‚  â”‚progress  â”‚  â”‚templates â”‚  â”‚templates â”‚  â”‚assignm.  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚workout_  â”‚  â”‚workout_  â”‚  â”‚ set_logs â”‚  â”‚ invoices â”‚       â”‚
â”‚  â”‚sessions  â”‚  â”‚exercise_ â”‚  â”‚          â”‚  â”‚          â”‚       â”‚
â”‚  â”‚          â”‚  â”‚logs      â”‚  â”‚          â”‚  â”‚          â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â”‚  ðŸ” Row Level Security (RLS) activo en todas las tablas        â”‚
â”‚  ðŸ”‘ PolÃ­ticas por rol: Admin, Entrenador, RecepciÃ³n           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ FLUJO DE DATOS

### Login Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario â”‚                                      â”‚ Sistema â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                                                 â”‚
     â”‚  1. Ingresa email y password                   â”‚
     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
     â”‚                                                 â”‚
     â”‚                                          [Frontend]
     â”‚                                          api.auth.login()
     â”‚                                                 â”‚
     â”‚                                                 â–¼
     â”‚                                          POST /auth/login
     â”‚                                                 â”‚
     â”‚                                          [Backend Server]
     â”‚                                          Verifica credenciales
     â”‚                                          con Supabase Auth
     â”‚                                                 â”‚
     â”‚                                                 â–¼
     â”‚                                          SELECT * FROM staff
     â”‚                                          WHERE auth_user_id = ?
     â”‚                                                 â”‚
     â”‚  2. Retorna token + datos de staff             â”‚
     â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
     â”‚                                                 â”‚
     â”‚                                          [Frontend]
     â”‚                                          Guarda token en localStorage
     â”‚                                          Guarda user en localStorage
     â”‚                                                 â”‚
     â”‚  3. Redirige al Dashboard                      â”‚
     â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
     â”‚                                                 â”‚
```

### CRUD Flow (Ejemplo: Obtener Usuarios)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend  â”‚                                    â”‚  Backend   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                                  â”‚
      â”‚  1. api.users.getAll()                          â”‚
      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
      â”‚     Headers:                                     â”‚
      â”‚     Authorization: Bearer <token>                â”‚
      â”‚                                                  â”‚
      â”‚                                           [Servidor]
      â”‚                                           Verifica token
      â”‚                                                  â”‚
      â”‚                                                  â–¼
      â”‚                                           SELECT * FROM users
      â”‚                                           ORDER BY created_at DESC
      â”‚                                                  â”‚
      â”‚                                           [RLS Check]
      â”‚                                           Â¿Usuario tiene permiso?
      â”‚                                                  â”‚
      â”‚  2. Retorna array de usuarios                   â”‚
      â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
      â”‚     [{ id, name, email, ... }, ...]             â”‚
      â”‚                                                  â”‚
      â”‚  3. Actualiza UI                                â”‚
      â”‚                                                  â”‚
```

---

## ðŸ” SISTEMA DE SEGURIDAD

### Capas de Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CAPA 1: AutenticaciÃ³n con Supabase Auth (JWT)                 â”‚
â”‚                                                                 â”‚
â”‚  - Tokens firmados con clave secreta                           â”‚
â”‚  - ExpiraciÃ³n automÃ¡tica                                       â”‚
â”‚  - Refresh tokens para sesiones largas                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CAPA 2: ValidaciÃ³n en Servidor                                â”‚
â”‚                                                                 â”‚
â”‚  - VerificaciÃ³n de token en cada request                       â”‚
â”‚  - Consulta de datos del staff desde BD                        â”‚
â”‚  - ValidaciÃ³n de permisos por endpoint                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CAPA 3: Row Level Security (RLS) en PostgreSQL                â”‚
â”‚                                                                 â”‚
â”‚  - PolÃ­ticas aplicadas a nivel de base de datos                â”‚
â”‚  - Filtrado automÃ¡tico segÃºn rol del usuario                   â”‚
â”‚  - ProtecciÃ³n contra SQL injection                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Matriz de Permisos Detallada

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Recurso/Tabla    â”‚ Administra. â”‚ Entrenador  â”‚  RecepciÃ³n  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ users                â”‚             â”‚             â”‚             â”‚
â”‚  - Ver (SELECT)      â”‚     âœ…      â”‚     âœ…      â”‚     âœ…      â”‚
â”‚  - Crear (INSERT)    â”‚     âœ…      â”‚     âŒ      â”‚     âœ…      â”‚
â”‚  - Editar (UPDATE)   â”‚     âœ…      â”‚     âŒ      â”‚     âœ…      â”‚
â”‚  - Eliminar (DELETE) â”‚     âœ…      â”‚     âŒ      â”‚     âŒ      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ staff                â”‚             â”‚             â”‚             â”‚
â”‚  - Ver               â”‚     âœ…      â”‚     âŒ      â”‚     âŒ      â”‚
â”‚  - Crear             â”‚     âœ…      â”‚     âŒ      â”‚     âŒ      â”‚
â”‚  - Editar            â”‚     âœ…      â”‚     âŒ      â”‚     âŒ      â”‚
â”‚  - Eliminar          â”‚     âœ…      â”‚     âŒ      â”‚     âŒ      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ payments             â”‚             â”‚             â”‚             â”‚
â”‚  - Ver               â”‚     âœ…      â”‚     âœ…      â”‚     âœ…      â”‚
â”‚  - Crear             â”‚     âœ…      â”‚     âŒ      â”‚     âœ…      â”‚
â”‚  - Editar            â”‚     âœ…      â”‚     âŒ      â”‚     âœ…      â”‚
â”‚  - Eliminar          â”‚     âœ…      â”‚     âŒ      â”‚     âŒ      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ attendance           â”‚             â”‚             â”‚             â”‚
â”‚  - Ver               â”‚     âœ…      â”‚     âœ…      â”‚     âœ…      â”‚
â”‚  - Registrar         â”‚     âœ…      â”‚     âŒ      â”‚     âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ routine_templates    â”‚             â”‚             â”‚             â”‚
â”‚  - Ver               â”‚     âœ…      â”‚     âœ…      â”‚     âœ…      â”‚
â”‚  - Crear             â”‚     âœ…      â”‚     âœ…      â”‚     âŒ      â”‚
â”‚  - Editar            â”‚     âœ…      â”‚  âœ… (solo   â”‚     âŒ      â”‚
â”‚                      â”‚             â”‚   propias)  â”‚             â”‚
â”‚  - Eliminar          â”‚     âœ…      â”‚     âŒ      â”‚     âŒ      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ physical_progress    â”‚             â”‚             â”‚             â”‚
â”‚  - Ver               â”‚     âœ…      â”‚     âœ…      â”‚     âœ…      â”‚
â”‚  - Crear/Editar      â”‚     âœ…      â”‚     âœ…      â”‚     âŒ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“¦ ESTRUCTURA DE ARCHIVOS

```
gimnasio-los-teques/
â”‚
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â””â”€â”€ schema.sql              â† Schema SQL completo (Ejecutar en Supabase)
â”‚   â”‚
â”‚   â””â”€â”€ functions/
â”‚       â””â”€â”€ server/
â”‚           â”œâ”€â”€ index.tsx           â† Servidor Hono con endpoints
â”‚           â”œâ”€â”€ seed.tsx            â† Datos de prueba
â”‚           â””â”€â”€ kv_store.tsx        â† [Sistema - No editar]
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StatCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ DatabaseSetup.tsx  â† Componente para inicializaciÃ³n
â”‚   â”‚   â”‚   â””â”€â”€ ui/
â”‚   â”‚   â”‚       â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts              â† Cliente API TypeScript
â”‚   â”‚   â”‚   â””â”€â”€ mockData.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Users.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Payments.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Routines.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Staff.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Attendance.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TestSupabase.tsx   â† PÃ¡gina de testing
â”‚   â”‚   â”‚   â””â”€â”€ Layout.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts            â† TypeScript types
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ routes.ts
â”‚   â”‚   â””â”€â”€ App.tsx
â”‚   â”‚
â”‚   â””â”€â”€ styles/
â”‚       â”œâ”€â”€ index.css
â”‚       â”œâ”€â”€ theme.css
â”‚       â””â”€â”€ fonts.css
â”‚
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ supabase/
â”‚       â””â”€â”€ info.tsx                â† Info de Supabase (projectId, key)
â”‚
â”œâ”€â”€ INSTRUCCIONES_SUPABASE.md       â† GuÃ­a paso a paso
â”œâ”€â”€ GUIA_VISUAL_SUPABASE.md         â† Tutorial visual
â”œâ”€â”€ SUPABASE_STRUCTURE.md           â† Estructura de BD
â”œâ”€â”€ RESUMEN_CONFIGURACION.md        â† Resumen tÃ©cnico
â”œâ”€â”€ README_SUPABASE.md              â† Inicio rÃ¡pido
â”œâ”€â”€ ARQUITECTURA_SISTEMA.md         â† Este archivo
â”‚
â”œâ”€â”€ package.json
â””â”€â”€ vite.config.ts
```

---

## ðŸ—ƒï¸ MODELO DE DATOS

### Diagrama Entidad-RelaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    staff    â”‚ â† Tabla de Personal con autenticaciÃ³n
â”‚             â”‚
â”‚ id          â”‚â”€â”€â”
â”‚ auth_user_idâ”‚  â”‚
â”‚ name        â”‚  â”‚
â”‚ role        â”‚  â”‚ 1:N
â”‚ email       â”‚  â”‚
â”‚ phone       â”‚  â”‚
â”‚ shift       â”‚  â”‚
â”‚ status      â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                 â”‚
                 â”œâ”€â”€â”€ created_by â”€â”€â”€â”
                 â”‚                  â”‚
                 â”‚                  â–¼
                 â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚         â”‚ routine_templatesâ”‚
                 â”‚         â”‚                  â”‚
                 â”‚         â”‚ id               â”‚â”€â”€â”
                 â”‚         â”‚ name             â”‚  â”‚
                 â”‚         â”‚ level            â”‚  â”‚
                 â”‚         â”‚ category         â”‚  â”‚ 1:N
                 â”‚         â”‚ duration         â”‚  â”‚
                 â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                 â”‚                                â”‚
                 â”œâ”€â”€â”€ assigned_by â”€â”€â”€â”           â”‚
                 â”‚                   â”‚           â”‚
                 â”‚                   â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users    â”‚  â”‚         â”‚ user_routine_assignments  â”‚
â”‚ (miembros)  â”‚  â”‚         â”‚                           â”‚
â”‚             â”‚  â”‚         â”‚ id                        â”‚
â”‚ id          â”‚â”€â”€â”¤         â”‚ user_id         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ member_num  â”‚  â”‚         â”‚ routine_id      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ name        â”‚  â”‚         â”‚ assigned_by     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ email       â”‚  â”‚         â”‚ start_date                â”‚
â”‚ phone       â”‚  â”‚         â”‚ is_active                 â”‚
â”‚ status      â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ plan        â”‚  â”‚
â”‚ weight      â”‚  â”‚
â”‚ height      â”‚  â”‚
â”‚ imc         â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
      â”‚          â”‚
      â”‚ 1:N      â”‚
      â”‚          â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚          â”‚    â”‚    payments     â”‚
      â”‚          â”‚    â”‚                 â”‚
      â”‚          â”‚    â”‚ id              â”‚
      â”‚          â”‚    â”‚ user_id         â”‚
      â”‚          â”‚    â”‚ amount          â”‚
      â”‚          â”‚    â”‚ status          â”‚
      â”‚          â”‚    â”‚ method          â”‚
      â”‚          â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚          â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚          â”‚    â”‚   attendance    â”‚
      â”‚          â”‚    â”‚                 â”‚
      â”‚          â”‚    â”‚ id              â”‚
      â”‚          â”‚    â”‚ user_id         â”‚
      â”‚          â”‚    â”‚ date            â”‚
      â”‚          â”‚    â”‚ type            â”‚
      â”‚          â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚          â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚    â”‚physical_progressâ”‚
                 â”‚    â”‚                 â”‚
                 â”‚    â”‚ id              â”‚
                 â”‚    â”‚ user_id         â”‚
                 â”‚    â”‚ weight          â”‚
                 â”‚    â”‚ body_fat        â”‚
                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â””â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚workout_sessions â”‚
                      â”‚                 â”‚
                      â”‚ id              â”‚â”€â”€â”
                      â”‚ user_id         â”‚  â”‚
                      â”‚ routine_id      â”‚  â”‚ 1:N
                      â”‚ date            â”‚  â”‚
                      â”‚ is_completed    â”‚  â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                           â”‚
                                           â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚workout_exercise_logs â”‚
                              â”‚                      â”‚
                              â”‚ id                   â”‚â”€â”€â”
                              â”‚ session_id           â”‚  â”‚
                              â”‚ exercise_id          â”‚  â”‚ 1:N
                              â”‚ is_completed         â”‚  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                        â”‚
                                                        â–¼
                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                             â”‚   set_logs     â”‚
                                             â”‚                â”‚
                                             â”‚ id             â”‚
                                             â”‚ exercise_log_idâ”‚
                                             â”‚ set_number     â”‚
                                             â”‚ reps           â”‚
                                             â”‚ weight         â”‚
                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸš€ TECNOLOGÃAS UTILIZADAS

### Frontend
- **React 18** - Framework UI
- **TypeScript** - Tipado estÃ¡tico
- **Tailwind CSS v4** - Estilos
- **React Router** - NavegaciÃ³n
- **Lucide React** - Iconos
- **Recharts** - GrÃ¡ficas

### Backend
- **Supabase Edge Functions** - Serverless functions
- **Hono** - Framework web para Deno
- **Deno Runtime** - Runtime JavaScript/TypeScript
- **PostgreSQL** - Base de datos

### AutenticaciÃ³n y Seguridad
- **Supabase Auth** - Sistema de autenticaciÃ³n
- **JWT Tokens** - AutenticaciÃ³n basada en tokens
- **Row Level Security (RLS)** - Seguridad a nivel de BD
- **PolÃ­ticas de PostgreSQL** - Control de acceso granular

---

## ðŸ”„ CICLO DE VIDA DE UNA REQUEST

```
1. Usuario hace clic en botÃ³n
        â†“
2. Componente React llama a api.users.getAll()
        â†“
3. api.ts hace fetch con token del localStorage
        â†“
4. Request HTTPS a Supabase Edge Function
        â†“
5. Hono Server recibe la request
        â†“
6. Servidor verifica el token JWT
        â†“
7. Servidor consulta datos del usuario desde staff table
        â†“
8. Servidor hace query a PostgreSQL: SELECT * FROM users
        â†“
9. PostgreSQL aplica polÃ­ticas RLS segÃºn rol del usuario
        â†“
10. PostgreSQL retorna solo los datos permitidos
        â†“
11. Servidor formatea la respuesta JSON
        â†“
12. Response HTTPS al frontend
        â†“
13. api.ts parsea el JSON
        â†“
14. Componente React recibe los datos
        â†“
15. React actualiza el DOM
        â†“
16. Usuario ve los datos en pantalla
```

---

## ðŸ“ˆ ESCALABILIDAD

### Puntos de Escalabilidad

| Componente | Escalabilidad | Notas |
|------------|---------------|-------|
| **Frontend** | âœ… Alta | Deploy en CDN (Vercel, Netlify) |
| **Edge Functions** | âœ… Alta | Serverless, escala automÃ¡ticamente |
| **Database** | âœ… Media-Alta | PostgreSQL con conexiÃ³n pooling |
| **Auth** | âœ… Alta | Supabase Auth escala automÃ¡ticamente |

### Optimizaciones Implementadas

- âœ… **Ãndices en BD** - En columnas frecuentemente consultadas
- âœ… **Connection Pooling** - Supabase maneja el pool de conexiones
- âœ… **Lazy Loading** - Componentes React con code splitting
- âœ… **Caching** - localStorage para tokens y datos del usuario
- âœ… **Query Optimization** - Joins optimizados en PostgreSQL

---

## ðŸŽ¯ PATRONES DE DISEÃ‘O UTILIZADOS

### 1. Repository Pattern
```typescript
// AbstracciÃ³n de acceso a datos
api.users.getAll()
api.payments.create()
api.stats.getDashboard()
```

### 2. Singleton Pattern
```typescript
// Cliente API Ãºnico
import api from './lib/api';
```

### 3. Middleware Pattern
```typescript
// En el servidor Hono
app.use('*', logger(console.log));
app.use('/*', cors({ ... }));
```

### 4. Factory Pattern
```typescript
// CreaciÃ³n de requests con configuraciÃ³n
apiRequest('/users', { method: 'GET' })
```


**Creado para:** Gimnasio Los Teques, Sector Lagunetica  
**Arquitectura diseÃ±ada:** Febrero 2026  
**VersiÃ³n:** 1.0
